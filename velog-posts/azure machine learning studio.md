<h1 id="azure-gpu-✅">azure gpu ✅</h1>
<ul>
<li>colab 프로 결제해도 환경 구축하기에 한계가 있다</li>
</ul>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/ed81c1be-7c6c-49c9-84a9-fb1957344c5b/image.png" /></p>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/97828f1f-6320-4c95-ae1a-0f1affef804b/image.png" /></p>
<ul>
<li>데이터 넣으면 <strong>데이터 전처리 알아서 해줌</strong> <em>(AutoML)</em></li>
<li>학습 시키면 <strong>하이퍼 파라미터 튜닝 알아서 해줌</strong> <em>(AutoML)</em></li>
</ul>
<h2 id="azure-machine-learning-studio">Azure Machine Learning Studio</h2>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/134008a0-1191-436a-92b6-88b3b097ddfb/image.png" /></p>
<ul>
<li><strong>studio 시작하기</strong></li>
</ul>
<h3 id="titanic-분류">titanic 분류</h3>
<ul>
<li>titanic.csv 다운로드 : <a href="https://github.com/datasciencedojo/datasets/blob/master/titanic.csv">https://github.com/datasciencedojo/datasets/blob/master/titanic.csv</a></li>
</ul>
<h3 id="데이터-세트-만들기">데이터 세트 만들기</h3>
<ul>
<li>url_file vs 데이터 세트(표)</li>
</ul>
<h4 id="자산---데이터---만들기---url_file">자산 - 데이터 - 만들기 - url_file</h4>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/704eb31d-0121-4c57-9ab9-a367938f5d58/image.png" /></p>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/0d17777f-aacd-4442-a7d3-e74b2e585c24/image.png" /></p>
<h4 id="자산---데이터---만들기---표-형식">자산 - 데이터 - 만들기 - 표 형식</h4>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/0fd7e70e-cb2c-4233-8247-24834dcd03fc/image.png" /></p>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/dc991973-b400-4c99-8340-29e69f4879ee/image.png" /></p>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/bd90bb40-6597-41f6-90f1-b819e178d4ec/image.png" /></p>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/c4e0c01f-ba74-4c25-bc4b-069bbfd13221/image.png" /></p>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/eee5fc4e-05a9-4295-9139-d684043af438/image.png" /></p>
<ul>
<li>db에서 끌어올 수 있는듯</li>
<li>데이터 세트로 만드는 것이 다음과 같이 설정도 가능하고 더 편하게 쓸 수 있다.</li>
<li>쉽게 필요한 컬럼만 가져와서 사용할 수 있다.</li>
</ul>
<h3 id="디자이너-✅">디자이너 ✅</h3>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/c5f85079-ec09-4803-9a23-815272f2ee40/image.png" /></p>
<ul>
<li>다른사람이 한 모델들 불러와서 사용 가능하다</li>
<li>새로 만들기 (+) 버튼 클릭</li>
</ul>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/350af4f3-5752-4286-b460-4c4ba9ce20e8/image.png" /></p>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/39bb9b04-ee3b-4995-a98d-0f4cf56c9ece/image.png" /></p>
<h4 id="machine-learning-algorithm-cheat-sheet">Machine Learning Algorithm Cheat Sheet</h4>
<ul>
<li>머글을 위한 머신러닝 방법 찾기
<img alt="" src="https://velog.velcdn.com/images/rimgosu/post/2b71078b-5c69-41bb-9acf-e9f438623dd0/image.png" /></li>
</ul>
<h4 id="디자이너를-적당히-조합하여-다음과-같은-모델을-만들었다">디자이너를 적당히 조합하여 다음과 같은 모델을 만들었다.</h4>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/276e41af-f848-4c5b-91ea-371bccba3b68/image.png" /></p>
<h3 id="컴퓨팅">컴퓨팅</h3>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/ed8da38b-6d91-41ef-822b-577cd022c9b0/image.png" /></p>
<ul>
<li>새로 만들기 클릭</li>
</ul>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/594ccf44-4bd1-4da3-8ea1-adfa178aa558/image.png" /></p>
<ul>
<li>gpu로 선택하려면 ? 버튼으로 이메일 보내서 gpu 할당해달라고 메일 보내야함</li>
</ul>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/e81e6b3c-d313-4795-9c84-82b4663ef5db/image.png" /></p>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/3affc3e5-ca4d-450a-bd7f-8fc799829f3f/image.png" /></p>
<ul>
<li>다시 디자이너로 돌아와서 구성 및 제출하면 된다.</li>
</ul>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/787afe00-a45c-4c70-a860-7a2fd42379af/image.png" /></p>
<h3 id="작업">작업</h3>
<ul>
<li>제출하면 다음과 같이 머신러닝 하는 것을 시각적으로 확인할 수 있다.</li>
</ul>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/e4eac9bc-f517-4c30-a0bb-a9054a6c50dd/image.png" /></p>
<ul>
<li>데이터 미리보기로 평가 지표 시각화 가능</li>
</ul>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/18bfe76a-bae8-46db-9c64-ac2e062cd21a/image.png" /></p>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/4d1b6c50-04d2-4f3c-8f08-840845026dc2/image.png" /></p>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/2050e786-c1ea-46e8-ad68-5d31aecf5586/image.png" /></p>
<h3 id="자동화된-ml-👍✅">자동화된 ML 👍✅</h3>
<ul>
<li>AutoML</li>
<li>두꺼운 법인카드만 있으면 짱이다</li>
</ul>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/cdeb395f-1b86-4ffc-8630-4b7f9eb147dc/image.png" /></p>
<ul>
<li><p>분류, 회귀, 시계열 예측, 자연어 처리, cv 가능하다
<img alt="" src="https://velog.velcdn.com/images/rimgosu/post/def626a5-76e3-491a-8877-b57e054d8fca/image.png" /></p>
</li>
<li><p>라벨 데이터 설정
<img alt="" src="https://velog.velcdn.com/images/rimgosu/post/c9623a28-2127-4b66-8ffc-e35cb93f74a4/image.png" /></p>
</li>
<li><p>점수를 어떤 기준으로 할 것인지 체크
<img alt="" src="https://velog.velcdn.com/images/rimgosu/post/18947e2b-0f68-4a3c-a7c2-2ef220ad596e/image.png" /></p>
</li>
</ul>
<h3 id="notebooks-✍️">NoteBooks ✍️</h3>
<ul>
<li>새 파일 만들기</li>
</ul>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/5effcecb-6c29-49c2-932f-f873b933c832/image.png" /></p>
<ul>
<li>환경 : Python 3.8 - AzureML</li>
</ul>
<h4 id="작업-공간-만들기">작업 공간 만들기</h4>
<pre><code>from azureml.core import Workspace 
from azureml.core import Experiment 
ws = Workspace.from_config() 
print('Workspace name: ' + ws.name,  
      'Azure region: ' + ws.location,  
      'Subscription id: ' + ws.subscription_id,  
      'Resource group: ' + ws.resource_group, sep='\\n')

experiment = Experiment(workspace=ws, name=&quot;diabetes-experiment&quot;)</code></pre><ul>
<li>job 탭에서 작업공간 만들어진 것 확인할 수 있다.</li>
<li>이후는 원래 하듯이 ml 돌리면 된다.</li>
</ul>
<h4 id="학습-코드">학습 코드</h4>
<pre><code>from azureml.opendatasets import Diabetes 
from sklearn.model_selection import train_test_split 

x_df = Diabetes.get_tabular_dataset().to_pandas_dataframe().dropna() 
y_df = x_df.pop(&quot;Y&quot;) 

X_train, X_test, y_train, y_test = train_test_split(x_df, y_df, test_size=0.2, random_state=66) 

print(X_train) 
</code></pre><h4 id="best-model-다운로드">best model 다운로드</h4>
<pre><code>from sklearn.linear_model import Ridge 
from sklearn.metrics import mean_squared_error 
from sklearn.externals import joblib 
import math 


alphas = [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0] 


for alpha in alphas: 
    run = experiment.start_logging() 
    run.log(&quot;alpha_value&quot;, alpha) 


    model = Ridge(alpha=alpha) 
    model.fit(X=X_train, y=y_train) 
    y_pred = model.predict(X=X_test) 
    rmse = math.sqrt(mean_squared_error(y_true=y_test, y_pred=y_pred)) 
    run.log(&quot;rmse&quot;, rmse) 


    model_name = &quot;model_alpha_&quot; + str(alpha) + &quot;.pkl&quot; 
    filename = &quot;outputs/&quot; + model_name 


    joblib.dump(value=model, filename=filename) 
    run.upload_file(name=model_name, path_or_stream=filename) 
    run.complete() 
    print(f&quot;{alpha} exp completed&quot;) </code></pre><h4 id="데이터셋-등록">데이터셋 등록</h4>
<pre><code>import numpy as np 
from azureml.core import Dataset 


np.savetxt('features.csv', X_train, delimiter=',') 
np.savetxt('labels.csv', y_train, delimiter=',') 


datastore = ws.get_default_datastore() 
datastore.upload_files(files=['./features.csv', './labels.csv'], 
                       target_path='diabetes-experiment/', 
                       overwrite=True) 


input_dataset = Dataset.Tabular.from_delimited_files(path=[(datastore, 'diabetes-experiment/features.csv')]) 
output_dataset = Dataset.Tabular.from_delimited_files(path=[(datastore, 'diabetes-experiment/labels.csv')])</code></pre><h4 id="모델-등록">모델 등록</h4>
<pre><code>import sklearn 


from azureml.core import Model 
from azureml.core.resource_configuration import ResourceConfiguration 


model = Model.register(workspace=ws, 
                       model_name='diabetes-experiment-model', 
                       model_path=f&quot;./{str(best_run.get_file_names()[0])}&quot;,  
                       model_framework=Model.Framework.SCIKITLEARN,   
                       model_framework_version=sklearn.__version__,   
                       sample_input_dataset=input_dataset, 
                       sample_output_dataset=output_dataset, 
                       resource_configuration=ResourceConfiguration(cpu=1, memory_in_gb=0.5), 
                       description='Ridge regression model to predict diabetes progression.', 
                       tags={'area': 'diabetes', 'type': 'regression'}) 


print('Name:', model.name) 
print('Version:', model.version) 
</code></pre><ul>
<li><p>다음과 같이 모델이 웹에 모델이 등록된 것을 확인할 수 있다</p>
<p> <img alt="" src="https://velog.velcdn.com/images/rimgosu/post/9b9416bc-5964-4576-b5e2-e9cf8894cfbf/image.png" /></p>
</li>
</ul>
<h4 id="모델-배포">모델 배포</h4>
<ul>
<li>도커 컨테이너로 배포하여 사용할 수 있게 한다</li>
</ul>
<pre><code>service_name = 'diabetes-service' 


service = Model.deploy(ws, service_name, [model], overwrite=True) 
service.wait_for_deployment(show_output=True) 
</code></pre><h4 id="배포-서비스-테스트">배포 서비스 테스트</h4>
<pre><code>import json 

input_payload = json.dumps({ 
    'data': X_train[0:2].values.tolist(), 
    'method': 'predict' 
}) 

output = service.run(input_payload) 

print(output) </code></pre><h3 id="엔드포인트에서-확인">엔드포인트에서 확인</h3>
<ul>
<li>학습된 모델 엔트포인트를 확인할 수 있다.</li>
</ul>
<p><img alt="" src="https://velog.velcdn.com/images/rimgosu/post/980e2239-20e8-4bd6-b0a1-cdeae4067dee/image.png" /></p>